<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ìš°ë¦¬ì‚¬ì£¼ ê°„ì´ê³„ì‚°ê¸° Beta</title>
  <meta name="description" content="ìš°ë¦¬ì‚¬ì£¼ ì¸ì¶œ ì‹œ ì„¸í›„ê°€ì¹˜Â·ìˆœì´ìµ(ê·¼ì‚¬)ê¹Œì§€ ê³„ì‚°í•˜ëŠ” ë©€í‹°-ë¡œíŠ¸ ê³„ì‚°ê¸°" />
  <script src="https://cdn.tailwindcss.com">
// === Profile Save/Load (input-based) ===
function getAppState(){
  return { v: JSON.parse(JSON.stringify(v)), lots: JSON.parse(JSON.stringify(lots)) };
}
function setAppState(st){
  if(st.v){ v = Object.assign(v, st.v); }
  if(st.lots){ lots = st.lots; }
  render();
}
function readProfileName(){
  return (document.getElementById('profileName').value||'').trim();
}
function saveProfile(){
  const name = readProfileName();
  if(!name){ alert('í”„ë¡œí•„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  localStorage.setItem('ESOP_PROFILE_'+name, JSON.stringify(getAppState()));
  alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
function loadProfile(){
  const name = readProfileName();
  if(!name){ alert('ë¶ˆëŸ¬ì˜¬ í”„ë¡œí•„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  const raw = localStorage.getItem('ESOP_PROFILE_'+name);
  if(!raw){ alert('í•´ë‹¹ ì´ë¦„ì˜ í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
  setAppState(JSON.parse(raw));
}
function deleteProfile(){
  const name = readProfileName();
  if(!name){ alert('ì‚­ì œí•  í”„ë¡œí•„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  if(!localStorage.getItem('ESOP_PROFILE_'+name)){ alert('í•´ë‹¹ ì´ë¦„ì˜ í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
  if(confirm('['+name+'] í”„ë¡œí•„ì„ ì‚­ì œí• ê¹Œìš”?')){
    localStorage.removeItem('ESOP_PROFILE_'+name);
    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
}
document.addEventListener('DOMContentLoaded', ()=>{
  document.getElementById('btnSaveProfile').addEventListener('click', saveProfile);
  document.getElementById('btnLoadProfile').addEventListener('click', loadProfile);
  document.getElementById('btnDeleteProfile').addEventListener('click', deleteProfile);
});
</script>
  <style>
    body { font-family: 'Pretendard','Apple SD Gothic Neo',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans',sans-serif; }
    input.num { text-align:right; font-variant-numeric: tabular-nums; }
    input[disabled] { background:#ecfdf5!important; color:#6b7280!important; cursor:not-allowed; }
    .cute-focus:focus { box-shadow: 0 0 0 3px rgba(16,185,129,.25); border-color:#34d399; outline:none; }
    .mint-card { border-radius: 1.25rem; border:1px solid #a7f3d0; background: rgba(255,255,255,.94); box-shadow: 0 10px 24px rgba(16,185,129,.08); }
    .mint-btn { border-radius:9999px; padding:.35rem .7rem; font-size:.8rem; font-weight:700; border:1px solid #a7f3d0; background:white; color:#065f46; }
    .tbl th,.tbl td{ border-bottom:1px solid #d1fae5; }
  </style>
</head>
<body class="bg-emerald-50 text-gray-900">
  <header class="sticky top-0 z-10 bg-gradient-to-r from-emerald-200 to-emerald-100 backdrop-blur border-b border-emerald-300 shadow-sm">
    <div class="mx-auto max-w-6xl px-5 py-3 flex items-center justify-between">
      <h1 class="text-lg font-extrabold text-emerald-800 tracking-tight">
        ìš°ë¦¬ì‚¬ì£¼ ê°„ì´ê³„ì‚°ê¸° <span class="text-xs text-emerald-700 align-top">Beta</span>
      </h1>
        
        <div class="mt-2 mb-4 flex flex-wrap items-center gap-2">
          <input id="profileName" type="text" placeholder="í”„ë¡œí•„ ì´ë¦„" class="rounded-xl border border-emerald-300 px-3 py-2 cute-focus w-60"/>
          <button id="btnSaveProfile" class="rounded-xl bg-emerald-600 text-white px-3 py-2 shadow">í”„ë¡œí•„ ì €ì¥</button>
          <button id="btnLoadProfile" class="rounded-xl bg-emerald-500 text-white px-3 py-2 shadow">ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button id="btnDeleteProfile" class="rounded-xl bg-rose-500 text-white px-3 py-2 shadow">ì‚­ì œ</button>
        </div>
        
        <div class="mb-4 text-sm text-emerald-700">
          <span class="relative group cursor-help font-semibold text-emerald-700">â“
            <span class="absolute hidden group-hover:block bg-white text-gray-700 border border-gray-300 rounded-md p-2 text-[11px] w-72 left-1/2 -translate-x-1/2 mt-1 shadow-lg z-10">
              ì…ë ¥í•œ ë‚´ìš©ê³¼ ì €ì¥í•œ í”„ë¡œí•„ì€ ì‚¬ìš©ìì˜ <strong>ë¸Œë¼ìš°ì €(LocalStorage)</strong>ì—ë§Œ ë³´ê´€ë˜ë©°, ì¸í„°ë„·ì´ë‚˜ ì„œë²„ë¡œ <strong>ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong><br>
              ë‹¤ë¥¸ ê¸°ê¸°Â·ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë™ì¼í•œ í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
            </span>
          </span>
        </div>


    

      <a href="#how" class="text-sm text-emerald-800 hover:text-emerald-900">ë¡œì§/ì£¼ì˜ì‚¬í•­ ğŸ’¡</a>
    </div>
    <div class="mx-auto max-w-6xl px-5 pb-3">
      <div class="rounded-2xl border border-emerald-300 bg-emerald-100/70 text-emerald-900 text-xs p-3 leading-5 shadow-sm">
        <span class="font-semibold">ğŸ“‹ ì¤€ë¹„ë¬¼:</span>
        ìš°ë¦¬ì‚¬ì£¼ ìƒì„¸ë‚´ì—­, ì§ì „ì—°ë„ ê·¼ë¡œì†Œë“ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦, (ìˆë‹¤ë©´) ì¢…í•©ì†Œë“ì„¸ ì‹ ê³ ë‚´ì—­
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-5 py-6 space-y-6">
    <!-- ì¸ì¶œ ë¡œíŠ¸ ì…ë ¥ (Full width) -->
    <section class="mint-card p-5">
      <div class="flex items-center justify-between">
        <h2 class="mb-3 text-lg font-semibold text-emerald-800">ì¸ì¶œ ë¡œíŠ¸ ì…ë ¥ (ì—¬ëŸ¬ í–‰ ì¶”ê°€ ê°€ëŠ¥) ğŸ“‹</h2>
        <div class="flex gap-2">
          <button id="addRow" class="mint-btn">+ í–‰ ì¶”ê°€</button>
          <button id="clearRows" class="mint-btn">ğŸ§¹ í–‰ ëª¨ë‘ ì‚­ì œ</button>
        </div>
      </div>
      <div class="overflow-auto">
        <table class="w-full text-xs tbl">
          <thead class="text-emerald-800">
            <tr>
              <th class="text-left px-2 py-1.5">#</th>
              <th class="text-left px-2 py-1.5 w-24">ì·¨ë“ì¼ì</th>
              <th class="text-left px-2 py-1.5">ì¶œì—°êµ¬ë¶„</th>
              <th class="text-right px-2 py-1.5 w-20">ì·¨ë“ë‹¨ê°€</th>
              <th class="text-right px-2 py-1.5 w-20">ì‹¤ì œ ë‚©ì…ë‹¨ê°€</th>
              <th class="text-right px-2 py-1.5">ì¸ì¶œì£¼ì‹ìˆ˜</th>
              <th class="text-right px-2 py-1.5"><div>ë³´ìœ ê¸°ê°„</div><div class="text-[10px] text-gray-500">(ì˜ë¬´ì˜ˆíƒ ì œì™¸)</div></th>
              <th class="text-center px-2 py-1.5">ê³¼ì„¸êµ¬ë¶„ <span class="relative group cursor-help">â“<span class="absolute hidden group-hover:block bg-white text-gray-700 border border-gray-300 rounded-md p-2 text-[11px] w-max left-1/2 -translate-x-1/2 mt-1 shadow">ë¹„ê³¼ì„¸ : ê³¼ê±° ì¶œì—° ë‹¹ì‹œ 400ë§Œì› í•œë„ ì´ˆê³¼ë¶„</span></span></th>
              <th class="text-right px-2 py-1.5">ë¹„ê³¼ì„¸ìœ¨</th>
              <th class="text-right px-2 py-1.5">ê³¼ì„¸ë‹¨ê°€</th>
              <th class="text-right px-2 py-1.5">ê³¼ì„¸ ê¸ˆì•¡</th>
              <th class="text-center px-2 py-1.5">ì‘ì—…</th>
            </tr>
          </thead>
          <tbody id="lotBody"></tbody>
        </table>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-3">
        <label class="grid grid-cols-1 gap-1">
          <span class="text-sm text-gray-700">ì˜ë¬´ì˜ˆíƒê¸°ê°„(ê³µí†µ)</span>
          <div class="flex items-center gap-2">
            <input id="escrowYears" type="text" class="num w-24 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="1" />
            <span class="text-xs text-gray-500">ë…„</span>
          </div>
        </label>
        <label class="grid grid-cols-1 gap-1">
          <span class="text-sm text-gray-700">ì¸ì¶œì¼ì(ê³µí†µ)</span>
          <input id="wdDate" type="date" class="w-full sm:w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" />
        </label>
        <label class="grid grid-cols-1 gap-1">
          <span class="text-sm text-gray-700">ì¸ì¶œì¼ì ì‹œê°€(ê³µí†µ)</span>
          <div class="flex items-center gap-2">
            <input id="fmvAtWithdraw" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="0" />
            <span class="text-xs text-gray-500">ì›/ì£¼</span>
          </div>
        </label>
      </div>
      <p class="text-xs text-emerald-700 mt-2">â€» ê° í–‰ì€ ë™ì¼ ì·¨ë“ì¼Â·ë‹¨ê°€ì—ì„œ ì¸ì¶œí•˜ëŠ” ìˆ˜ëŸ‰ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
    </section>

    <section class="grid grid-cols-1 gap-6 md:grid-cols-2">
      <!-- ì¢Œ: ê¸‰ì—¬ & ê³µì œ -->
      <div class="space-y-6">
        <div class="mint-card p-5">
          <h2 class="mb-3 text-lg font-semibold text-emerald-800">ê¸‰ì—¬ ì •ë³´ ğŸ§¾</h2>
          <div class="space-y-2">
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700 whitespace-nowrap">ì§ì „ì—°ë„ ì´ê¸‰ì—¬ì•¡</span>
              <input id="prevYearSalary" type="text" class="num w-56 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="0" />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì˜¬í•´ ì˜ˆìƒ ì´ê¸‰ì—¬ì•¡</span>
              <input id="currYearSalary" type="text" class="num w-56 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="0" />
            </label>
            <label class="flex items-start justify-between gap-3">
              <span class="text-sm text-gray-700">ê·¼ë¡œ ì™¸ ì¢…í•©ì†Œë“ê¸ˆì•¡</span>
              <input id="otherIncome" type="text" class="num w-56 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="0" />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì¤‘ì†Œê¸°ì—… ì—¬ë¶€ ğŸŒ±</span>
              <input id="isSME" type="checkbox" class="h-5 w-5 accent-emerald-500" />
            </label>
            <p class="text-xs text-emerald-700 leading-5 mt-1">â€» ì´ê¸‰ì—¬ì•¡ì€ ê¸‰ì—¬ëª…ì„¸ì„œì˜ <strong>ì´ì§€ê¸‰ì•¡</strong>(ì„±ê³¼ê¸‰ í¬í•¨) ê¸°ì¤€ ê·¼ì‚¬ì¹˜ì˜ˆìš”.</p>
          </div>
        </div>

        <div class="mint-card p-5">
          <div class="flex items-center justify-between">
            <h2 class="mb-3 text-lg font-semibold text-emerald-800">ê³µì œ(ê·¼ì‚¬) ì„¤ì • ğŸ§®</h2>
            <button id="toggleSI" class="mint-btn text-xs">4ëŒ€ë³´í—˜ìœ¨ í¸ì§‘</button>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">ê¸°ë³¸ê³µì œ ì¸ì›(ë³¸ì¸ í¬í•¨)</span>
              <input id="basicDeductCount" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="1" />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">êµ­ë¯¼ì—°ê¸ˆìœ¨(ê·¼ë¡œì, %)</span>
              <input id="rateNP" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2" value="4.5" disabled />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">ê±´ê°•ë³´í—˜ìœ¨(ê·¼ë¡œì, %)</span>
              <input id="rateHI" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2" value="3.545" disabled />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">ì¥ê¸°ìš”ì–‘(ê±´ë³´ì˜ %, ê·¼ë¡œì)</span>
              <input id="rateLTC" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2" value="12.95" disabled />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">ê³ ìš©ë³´í—˜ìœ¨(ê·¼ë¡œì, %)</span>
              <input id="rateEI" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2" value="0.9" disabled />
            </label>

            <div class="sm:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-2 items-end">
              <label class="flex items-center justify-between gap-3">
                <span class="text-gray-700">ìš°ë¦¬ì‚¬ì£¼ ì¶œì—° ì†Œë“ê³µì œ (ì›)</span>
                <input id="esopDeduct" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2" value="0" />
              </label>
              <label class="flex items-center justify-between gap-3">
                <span class="text-gray-700">ê¸°íƒ€ ì†Œë“ê³µì œ (ì›)</span>
                <input id="otherDeductions" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="0" />
              </label>
            </div>
          </div>

          <div class="mt-4 flex flex-wrap items-center gap-2 justify-between">
            <button id="resetBtn" class="mint-btn text-xs md:text-sm">ğŸ”„ ì…ë ¥ ì´ˆê¸°í™”</button>
            <div class="flex items-center gap-2">
              <button id="copyUrlBtn" class="mint-btn text-xs md:text-sm">ğŸ”— ì…ë ¥ ê³µìœ  ë§í¬</button>
              <button id="downloadBtn" class="mint-btn text-xs md:text-sm">ğŸ“¥ ê²°ê³¼ CSV</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ìš°: ê²°ê³¼ -->
      <div class="space-y-6">
        <div class="mint-card p-5">
          <h3 class="mb-2 font-semibold text-emerald-800">ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ í•©ì‚° ê¸ˆì•¡ (ë¡œíŠ¸ í•©ê³„) ğŸ’°</h3>
          <div id="withdrawBox" class="text-sm text-gray-800"></div>
        </div>

        <div class="mint-card p-5">
          <h3 class="mb-2 font-semibold text-emerald-800">ì„¸ìœ¨ êµ¬ê°„ & ê²°ë¡ (ì„¸í›„ê°€ì¹˜/ìˆœì´ìµ, ê·¼ì‚¬) ğŸ“ˆ</h3>
          <div id="taxbox" class="text-sm text-gray-800"></div>
        </div>

        <div class="mint-card p-5 text-sm leading-6 text-emerald-800">
          <div class="text-xs text-emerald-700">â€» ë³¸ ê³„ì‚°ê¸°ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ì‹ ê³ ëŠ” íšŒì‚¬ ê·œì • ë° ì„¸ë¬´ì „ë¬¸ê°€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
        </div>
      </div>
    </section>

    <!-- Notes -->
    <section id="how" class="mt-2 mint-card p-5">
      <h3 class="mb-2 text-base font-semibold text-emerald-800">ğŸ“˜ ê³„ì‚° ë¡œì§ ìš”ì•½ & ì£¼ì˜ì‚¬í•­</h3>
      <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
        <li>ê° ë¡œíŠ¸ ê³¼ì„¸ë‹¨ê°€ = <strong>min(ì·¨ë“ë‹¨ê°€, ì¸ì¶œì¼ì ì‹œê°€)</strong></li>
        <li>ë¹„ê³¼ì„¸ìœ¨(ì˜ë¬´ì˜ˆíƒ ì¢…ë£Œ í›„ ë³´ìœ ê¸°ê°„ ê¸°ì¤€): <strong>2~4ë…„ ë¯¸ë§Œ 50%</strong>, <strong>4ë…„ ì´ìƒ 75%</strong>, <strong>6ë…„ ì´ìƒ 100%(ì¤‘ì†Œê¸°ì—…ë§Œ)</strong></li>
        <li>ì¶”ê°€ì„¸ê¸ˆ(ê·¼ì‚¬) = ì¸ì¶œë¶„ ê·¼ë¡œì†Œë“ í•©ê³„ Ã— ì¶”ì • í•œê³„ì„¸ìœ¨(ì§€ë°©ì„¸ í¬í•¨)</li>
        <li>ì„¸í›„ ê°€ì¹˜(ê·¼ì‚¬) = ì¸ì¶œì£¼ì‹ ì‹œê°€ê°€ì¹˜ âˆ’ ì¶”ê°€ì„¸ê¸ˆ(ê·¼ì‚¬)</li>
        <li>ìˆœì´ìµ(ê·¼ì‚¬) = ì„¸í›„ ê°€ì¹˜ âˆ’ ì‹¤ì œ ë‚©ì…ì›ê°€(ë¡œíŠ¸ë³„ ë‚©ì…ë‹¨ê°€Ã—ìˆ˜ëŸ‰ í•©)</li>
      </ul>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const toNumber = (x) => {
      const s = String(x ?? '').replace(/[^0-9.-]/g,'');
      const n = parseFloat(s);
      return Number.isFinite(n) ? n : 0;
    };
    const fmt = (n) => Number.isFinite(n) ? n.toLocaleString('ko-KR') : '';

    // ======= State =======
    let lots = []; // {id, acqDate, kind: 'ì§ì›'|'íšŒì‚¬', acqUnit, paidUnit, shares, taxFlag:'ê³¼ì„¸'}

    function addLot(acqDate='', acqUnit=0, shares=0, kind='ì§ì›', paidUnit=null, taxFlag='ê³¼ì„¸'){
      const id = Date.now().toString(36) + Math.random().toString(36).slice(2,6);
      // Rule: ì§ì› -> paidUnit = acqUnit, íšŒì‚¬ -> paidUnit = 0 (unless explicitly provided)
      let paid;
      if (paidUnit === null || typeof paidUnit === 'undefined' || isNaN(paidUnit)) {
        paid = (kind === 'ì§ì›') ? (acqUnit || 0) : 0;
      } else {
        paid = paidUnit;
      }
      lots.push({id, acqDate, kind, acqUnit, paidUnit: paid, shares, taxFlag});
      renderLots();
      render();
    }
    function removeLot(id){ lots = lots.filter(l => l.id !== id); renderLots(); render(); }
    function clearLots(){ lots = []; renderLots(); render(); }

    function bindLotRowEvents(tr, lot){
      const d = tr.querySelector('.lot-date');
      const k = tr.querySelector('.lot-kind');
      const a = tr.querySelector('.lot-acq');
      const p = tr.querySelector('.lot-paid');
      const s = tr.querySelector('.lot-shares');
      const del = tr.querySelector('.lot-del');
      const tf = tr.querySelector('.lot-taxflag');


      const applyPaidRule = () => {
        lot.paidUnit = (lot.kind === 'ì§ì›') ? (lot.acqUnit || 0) : 0;
        if (p) p.value = fmt(lot.paidUnit);
      };

      
      // Date mask: enforce YYYY-MM-DD in lot acq date
      d.addEventListener('input', ()=>{
        const onlyDigits = (d.value || '').replace(/\D/g, '').slice(0, 8); // YYYYMMDD max
        const y = onlyDigits.slice(0, 4);
        const m = onlyDigits.slice(4, 6);
        const dd = onlyDigits.slice(6, 8);
        let out = y;
        if (onlyDigits.length >= 5) out += '-' + m;
        else if (onlyDigits.length >= 4) out += '-';
        if (onlyDigits.length >= 7) out += '-' + dd;
        else if (onlyDigits.length >= 6) out += '-';
        const pos = out.length;
        d.value = out;
        try { d.setSelectionRange(pos, pos); } catch(e) {}
        lot.acqDate = (out.length === 10) ? out : '';
        render();
      });
    k.addEventListener('change', ()=>{ lot.kind = k.value; applyPaidRule(); render(); });
      a.addEventListener('input', ()=>{
        lot.acqUnit = toNumber(a.value);
        a.value = fmt(lot.acqUnit);
        applyPaidRule();
        render();
      });
      // paid input is disabled; not editable by user
      s.addEventListener('input', ()=>{ lot.shares = Math.max(0, Math.floor(toNumber(s.value))); s.value = fmt(lot.shares); render(); });
      tf.addEventListener('change', ()=>{ lot.taxFlag = tf.value; render(); });
      del.addEventListener('click', ()=> removeLot(lot.id));
    }

    function renderLots(){
      const body = $('lotBody');
      body.innerHTML = '';
      lots.forEach((lot, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-2 py-1.5 text-xs text-gray-500">${idx+1}</td>
          <td class="px-2 py-1.5"><input type="text" inputmode="numeric" maxlength="10" placeholder="YYYY-MM-DD" class="lot-date rounded-xl border border-emerald-300 px-3 py-1.5 cute-focus" value="${lot.acqDate||''}"></td>
          <td class="px-2 py-1.5">
            <select class="lot-kind rounded-xl border border-emerald-300 px-2 py-1.5 cute-focus">
              <option ${lot.kind==='ì§ì›'?'selected':''}>ì§ì›</option>
              <option ${lot.kind==='íšŒì‚¬'?'selected':''}>íšŒì‚¬</option>
            </select>
          </td>
          <td class="px-2 py-1.5 text-right"><input type="text" class="num lot-acq w-20 rounded-xl border border-emerald-300 px-3 py-1.5 cute-focus" value="${fmt(lot.acqUnit||0)}"></td>
          <td class="px-2 py-1.5 text-right"><input type="text" class="num lot-paid w-20 rounded-xl border border-emerald-300 px-3 py-1.5 cute-focus" value="${fmt(lot.paidUnit||0)}" disabled></td>
          <td class="px-2 py-1.5 text-right"><input type="text" class="num lot-shares w-24 rounded-xl border border-emerald-300 px-3 py-1.5 cute-focus" value="${fmt(lot.shares||0)}"></td>
          <td class="px-2 py-1.5 text-right text-xs text-gray-600 lot-hold">-</td>
          <td class="px-2 py-1.5 text-center">
            <select class="lot-taxflag rounded-xl border border-emerald-300 px-2 py-1.5 cute-focus">
              <option value="ê³¼ì„¸" ${lot.taxFlag==='ê³¼ì„¸'?'selected':''}>ê³¼ì„¸</option>
              <option value="ë¹„ê³¼ì„¸" ${lot.taxFlag==='ë¹„ê³¼ì„¸'?'selected':''}>ë¹„ê³¼ì„¸</option>
            </select>
          </td>
          <td class="px-2 py-1.5 text-right text-xs text-gray-600 lot-exempt">-</td>
          <td class="px-2 py-1.5 text-right text-xs text-gray-600 lot-taxunit">-</td>
          <td class="px-2 py-1.5 text-right text-xs text-gray-600 lot-taxamt">-</td>
          <td class="px-2 py-1.5 text-center"><button class="lot-del px-2 py-1 border border-emerald-300 rounded-lg">ì‚­ì œ</button></td>
        `;
        body.appendChild(tr);
        bindLotRowEvents(tr, lot);
      });

      // === Auto focus: if user types only year, append '-' to move to month ===
      const dateInputs = document.querySelectorAll('.lot-date');
      dateInputs.forEach(inp => {
        inp.addEventListener('input', (e) => {
          const val = e.target.value;
          if (/^\d{4}$/.test(val)) {
            e.target.value = val + '-';
          }
        });
      });

    }

    // ===== Helpers =====
    const allFieldIds = ['prevYearSalary','currYearSalary','otherIncome','fmvAtWithdraw','basicDeductCount','rateNP','rateHI','rateLTC','rateEI','otherDeductions','escrowYears','esopDeduct'];

    function bindMasks(){
      for (const id of allFieldIds){
        const el = $(id); if(!el) continue;
        el.addEventListener('input', ()=>{ el.value = fmt(toNumber(el.value)); render(); });
        el.value = fmt(toNumber(el.value));
      }
      const wd = $('wdDate'); if (wd){ wd.addEventListener('input', render); wd.addEventListener('change', render); }
    }

    function read(){
      const v = {};
      for (const id of allFieldIds) v[id] = toNumber($(id)?.value || 0);
      v.basicDeductCount = Math.max(0, Math.floor(v.basicDeductCount));
      v.isSME = !!$('isSME')?.checked;
      v.wdDate = $('wdDate')?.value || '';
      return v;
    }

    function yearsBetween(aStr, bStr){
      if(!aStr || !bStr) return 0;
      const a = new Date(aStr), b = new Date(bStr);
      if (isNaN(a) || isNaN(b)) return 0;
      const ms = b - a;
      return Math.max(0, ms/(1000*60*60*24*365.25));
    }

    function earnedIncomeDeduction(gross){
      const x = Math.max(0, gross);
      if (x <= 12000000) return x*0.7;
      if (x <= 46000000) return 3600000 + (x-12000000)*0.4;
      if (x <= 88000000) return 7500000 + (x-46000000)*0.15;
      if (x <= 150000000) return 13500000 + (x-88000000)*0.05;
      return 16000000 + (x-150000000)*0.02;
    }
    function socialInsurance(prevGross, rNP, rHI, rLTC, rEI){
      const np = prevGross*(rNP/100);
      const hi = prevGross*(rHI/100);
      const ltc = hi*(rLTC/100);
      const ei = prevGross*(rEI/100);
      return {np,hi,ltc,ei,total:np+hi+ltc+ei};
    }

    // ===== Core render =====
    function render(){
      const v = read();

      // per-lot calc
      let totalShares=0, totalGross=0, totalExempt=0, totalTaxable=0, totalPaid=0;
      lots.forEach((lot, idx)=>{
        const holdYears = yearsBetween(lot.acqDate, v.wdDate);
        const afterEscrow = Math.max(0, holdYears - (v.escrowYears||0));
        let exemptRate = 0;
        if (afterEscrow >= 6 && v.isSME) exemptRate = 1.0;
        else if (afterEscrow >= 4) exemptRate = 0.75;
        else if (afterEscrow >= 2) exemptRate = 0.50;

        const taxUnit = Math.min(lot.acqUnit||0, v.fmvAtWithdraw||0);
        const gross = (lot.shares||0) * taxUnit;
        const exemptAmt = Math.round(gross*exemptRate);
        let taxable = Math.max(0, gross - exemptAmt);
        if ((lot.taxFlag||'ê³¼ì„¸') === 'ë¹„ê³¼ì„¸') {
          taxable = 0;
        }
        const paid = (lot.shares||0) * (lot.paidUnit||0);

        totalShares += (lot.shares||0);
        totalGross += gross;
        totalExempt += exemptAmt;
        totalTaxable += taxable;
        totalPaid += paid;

        const row = $('lotBody').children[idx];
        if(row){
          row.querySelector('.lot-hold').textContent = `${afterEscrow.toFixed(2)}ë…„`;
          row.querySelector('.lot-exempt').textContent = ( (lot.taxFlag||'ê³¼ì„¸')==='ë¹„ê³¼ì„¸' ? 'ë¹„ê³¼ì„¸' : `${Math.round(exemptRate*100)}%` );
          row.querySelector('.lot-taxunit').textContent = `${taxUnit.toLocaleString('ko-KR')} ì›/ì£¼`;
          row.querySelector('.lot-taxamt').textContent = `${taxable.toLocaleString('ko-KR')} ì›`;
        }
      });

      // B box: summary
      $('withdrawBox').innerHTML = `
        <div class="grid grid-cols-1 gap-3">
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ì¸ì¶œ ì´ ì£¼ì‹ìˆ˜</div>
              <div class="text-lg font-semibold text-emerald-900">${(totalShares).toLocaleString('ko-KR')} <span class="text-sm">ì£¼</span></div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ì¸ì¶œ ì‹œê°€(ê³µí†µ)</div>
              <div class="text-lg font-semibold text-emerald-900">${(v.fmvAtWithdraw||0).toLocaleString('ko-KR')} <span class="text-sm">ì›/ì£¼</span></div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ì˜ë¬´ì˜ˆíƒê¸°ê°„(ê³µí†µ)</div>
              <div class="text-lg font-semibold text-emerald-900">${(v.escrowYears||0)} <span class="text-sm">ë…„</span></div>
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">í•©ì‚° ê¸ˆì•¡(ë¹„ê³¼ì„¸ ì „)</div>
              <div class="text-lg font-semibold text-emerald-900">${(totalGross).toLocaleString('ko-KR')} <span class="text-sm">ì›</span></div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ë¹„ê³¼ì„¸ í•©ê³„</div>
              <div class="text-lg font-semibold text-emerald-900">${(totalExempt).toLocaleString('ko-KR')} <span class="text-sm">ì›</span></div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ê·¼ë¡œì†Œë“ í•©ì‚° ê¸ˆì•¡(ë¹„ê³¼ì„¸ í›„)</div>
              <div class="text-lg font-semibold text-emerald-900">${(totalTaxable).toLocaleString('ko-KR')} <span class="text-sm">ì›</span></div>
            </div>
          </div>
        </div>`;

      // tax & conclusions
      const eidBase = earnedIncomeDeduction(v.currYearSalary);
      const eidAfter = earnedIncomeDeduction(v.currYearSalary + totalTaxable);
      const eidIncr = Math.max(0, eidAfter - eidBase);
      const si = socialInsurance(v.prevYearSalary, v.rateNP, v.rateHI, v.rateLTC, v.rateEI);
      const basic = v.basicDeductCount * 1500000;
      const baseEarned = Math.max(0, (v.currYearSalary + totalTaxable) - eidAfter - si.total);
      const approxTaxable = Math.max(0, baseEarned + v.otherIncome - basic - v.esopDeduct - v.otherDeductions);

      const brackets = [
        { upTo: 14000000,  rate: 0.06 },
        { upTo: 50000000,  rate: 0.15 },
        { upTo: 88000000,  rate: 0.24 },
        { upTo: 150000000, rate: 0.35 },
        { upTo: 300000000, rate: 0.38 },
        { upTo: 500000000, rate: 0.40 },
        { upTo: 1000000000,rate: 0.42 },
        { upTo: Infinity,  rate: 0.45 },
      ];
      let marginalRate = 0.45;
      for (const b of brackets){ if (approxTaxable <= b.upTo){ marginalRate = b.rate; break; } }
      const marginalWithLocal = marginalRate * 1.10;
      const estimatedAdditionalTax = Math.round(totalTaxable * marginalWithLocal);

      const totalFMVValue = Math.round((v.fmvAtWithdraw||0) * (totalShares||0)); // ì‹œê°€ê°€ì¹˜
      const afterTaxValue = Math.max(0, totalFMVValue - estimatedAdditionalTax);
      const netGain = afterTaxValue - totalPaid;

      const taxRows = brackets.map((b, i)=>{
        const from = i===0 ? 0 : brackets[i-1].upTo+1;
        const to = b.upTo===Infinity ? 'ì´ìƒ' : `${fmt(b.upTo)}ì›`;
        const isMy = approxTaxable <= b.upTo;
        return `<tr class="${isMy?'bg-emerald-50':''}">
          <td class="px-3 py-1 text-right">${fmt(from)}ì› ~ ${to}</td>
          <td class="px-3 py-1 text-right">${Math.round(b.rate*100)}%</td>
          <td class="px-3 py-1 text-right">${Math.round(b.rate*11000)/100}% (ì§€ë°©ì„¸ í¬í•¨)</td>
        </tr>`;
      }).join('');

      $('taxbox').innerHTML = `
        <div class="grid grid-cols-1 gap-4">
          <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3 text-sm<div class="grid grid-cols-2 gap-2">
              <div>ì˜¬í•´ ì˜ˆìƒ ì´ê¸‰ì—¬</div><div class="text-right font-semibold">${fmt(v.currYearSalary)} ì›</div>
              <div>ê·¼ë¡œ ì™¸ ì¢…í•©ì†Œë“ê¸ˆì•¡</div><div class="text-right font-semibold">${fmt(v.otherIncome)} ì›</div>
              <div>4ëŒ€ë³´í—˜(ê·¼ë¡œìÂ·ê·¼ì‚¬, ì „ê¸°)</div><div class="text-right font-semibold">${fmt(si.total)} ì› <span class="text-[11px] text-gray-500">(êµ­ë¯¼:${fmt(si.nps)}, ê±´ê°•:${fmt(si.hi)}, ì¥ê¸°ìš”ì–‘:${fmt(si.ltc)}, ê³ ìš©:${fmt(si.ei)})</span></div>
              <div>ê¸°ë³¸ê³µì œ</div><div class="text-right font-semibold">${fmt(basic)} ì›</div>
              <div>ìš°ë¦¬ì‚¬ì£¼ ì¶œì—° ì†Œë“ê³µì œ(ì…ë ¥)</div><div class="text-right font-semibold">${fmt(v.esopDeduct)} ì›</div>
              <div>ê¸°íƒ€ ì†Œë“ê³µì œ</div><div class="text-right font-semibold">${fmt(v.otherDeductions)} ì›</div>
              <div>+ ì¸ì¶œë¶„ ê·¼ë¡œì†Œë“(ë¹„ê³¼ì„¸ í›„)</div><div class="text-right font-semibold">${fmt(totalTaxable)} ì›</div>
              <div>ê·¼ë¡œì†Œë“ê³µì œ(ê·¼ì‚¬, ì¦ë¶„ ë°˜ì˜)</div><div class="text-right font-semibold">${fmt(eidAfter)} ì› <span class="text-[11px] text-emerald-700">(ì¦ê°€ë¶„: ${fmt(eidIncr)} ì›)</span></div>
              <div>ê³¼ì„¸í‘œì¤€(ê·¼ì‚¬)</div><div class="text-right font-semibold">${fmt(approxTaxable)} ì›</div>
            </div>v>
            </div>
          </div>

          <div class="overflow-auto">
            <table class="w-full text-xs">
              <thead class="text-emerald-700">
                <tr><th class="px-3 py-1 text-right">ê³¼ì„¸í‘œì¤€ êµ¬ê°„</th><th class="px-3 py-1 text-right">êµ­ì„¸ ì„¸ìœ¨</th><th class="px-3 py-1 text-right">í•©ì‚° ì„¸ìœ¨</th></tr>
              </thead>
              <tbody>${taxRows}</tbody>
            </table>
          </div>

          <!-- Additional tax FIRST -->
          <div class="rounded-xl bg-rose-100 border border-rose-300 p-4 mt-1 shadow-sm text-center">
            <div class="text-xs text-rose-900 mb-1">ì˜ˆìƒ ì¶”ê°€ì„¸ê¸ˆ(ê·¼ì‚¬)</div>
            <div class="text-xl font-extrabold text-rose-900">${fmt(estimatedAdditionalTax)} ì›</div>
          </div>

          <!-- FMV value -->
          <div class="rounded-xl bg-white border border-emerald-200 p-4 mt-1 shadow-sm text-center">
            <div class="text-xs text-emerald-700 mb-1">ì¸ì¶œì£¼ì‹ ê°€ì¹˜(ì‹œê°€ ê¸°ì¤€)</div>
            <div class="text-xl font-extrabold text-emerald-900">${fmt(totalFMVValue)} ì›</div>
          </div>

          <!-- After-tax value -->
          <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-4 mt-1 shadow-sm text-center">
            <div class="text-xs text-emerald-700 mb-1">ì„¸í›„ ê°€ì¹˜(ê·¼ì‚¬) = ì‹œê°€ê°€ì¹˜ âˆ’ ì˜ˆìƒ ì¶”ê°€ì„¸ê¸ˆ</div>
            <div class="text-xl font-extrabold text-emerald-900">${fmt(afterTaxValue)} ì›</div>
          </div>

          <!-- Net gain -->
          <div class="rounded-xl bg-indigo-50 border border-indigo-200 p-4 mt-1 shadow-sm text-center">
            <div class="text-xs text-indigo-700 mb-1">ì´ë²ˆ ì¸ì¶œ ìˆœì´ìµ(ê·¼ì‚¬) = ì„¸í›„ ê°€ì¹˜ âˆ’ ì‹¤ì œ ë‚©ì…ì›ê°€</div>
            <div class="text-xl font-extrabold text-indigo-900">${fmt(netGain)} ì›</div>
            <div class="text-[11px] text-indigo-700 mt-1">
              (ì‹œê°€ ${fmt(totalFMVValue)} âˆ’ ì„¸ê¸ˆ ${fmt(estimatedAdditionalTax)} âˆ’ ë‚©ì…ì›ê°€ ${fmt(totalPaid)})
            </div>
            <div class="text-[11px] text-indigo-700 mt-1">â€» ê³¼ê±° ìš°ë¦¬ì‚¬ì£¼ì¡°í•© ì¶œì—° ì‹œ ë°›ì€ ì†Œë“ê³µì œ í˜œíƒì€ ê³ ë ¤ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>
            <div class="text-[11px] text-indigo-700 mt-0.5">
              <span class="relative group cursor-pointer">â“<span class="absolute hidden group-hover:block text-xs text-gray-700 bg-white border border-gray-300 rounded-md p-2 w-max left-1/2 -translate-x-1/2 mt-1 shadow">ê·€í•˜ì˜ ê³¼ê±° ìš°ë¦¬ì‚¬ì£¼ì¡°í•© ì¶œì—° ì‹œ ë°›ì€ ì†Œë“ê³µì œëŠ” í˜„ì¬ ì„¸ìœ¨ êµ¬ê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì•½ ${fmt(Math.round(totalPaid * marginalWithLocal))} ì›ì…ë‹ˆë‹¤.</span></span>
            </div>
          </div>
        </div>`;
    }

    function bindActions(){
      $('toggleSI').addEventListener('click', ()=>{
        ['rateNP','rateHI','rateLTC','rateEI'].forEach(id=>{ const el=$(id); el.disabled = !el.disabled; });
      });
      $('addRow').addEventListener('click', ()=> addLot());
      $('clearRows').addEventListener('click', clearLots);
      $('resetBtn').addEventListener('click', ()=>{
        const defaults = {prevYearSalary:'0', currYearSalary:'0', otherIncome:'0', fmvAtWithdraw:'0', basicDeductCount:'1', rateNP:'4.5', rateHI:'3.545', rateLTC:'12.95', rateEI:'0.9', otherDeductions:'0', escrowYears:'1', esopDeduct:'0'};
        for (const k of Object.keys(defaults)) $(k).value = defaults[k];
        $('isSME').checked = false;
        $('wdDate').value = '';
        clearLots(); addLot();
        bindMasks(); render();
      });
      $('copyUrlBtn').addEventListener('click', ()=>{
        const params = new URLSearchParams();
        for (const id of allFieldIds) params.set(id, toNumber($(id).value));
        params.set('isSME', $('isSME').checked ? '1':'0');
        params.set('wdDate', $('wdDate').value||'');
        params.set('lots', encodeURIComponent(JSON.stringify(lots)));
        const url = `${location.origin}${location.pathname}?${params.toString()}`;
        navigator.clipboard.writeText(url).then(()=> alert('í˜„ì¬ ì…ë ¥ ë§í¬ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤ ğŸ˜Š'));
      });
      $('downloadBtn').addEventListener('click', ()=>{
        const rows = [
          ['í•­ëª©','ê°’'],
          ['ì˜¬í•´ ì˜ˆìƒ ì´ê¸‰ì—¬ì•¡', $('currYearSalary').value],
          ['ê·¼ë¡œ ì™¸ ì¢…í•©ì†Œë“ê¸ˆì•¡', $('otherIncome').value],
          ['ì¤‘ì†Œê¸°ì—… ì—¬ë¶€', $('isSME').checked?'Y':'N'],
          ['ì˜ë¬´ì˜ˆíƒê¸°ê°„(ë…„)', $('escrowYears').value],
          ['ì¸ì¶œì¼ì', $('wdDate').value],
          ['ì¸ì¶œì¼ì ì‹œê°€', $('fmvAtWithdraw').value],
          ['ìš°ë¦¬ì‚¬ì£¼ ì¶œì—° ì†Œë“ê³µì œ(ì…ë ¥)', $('esopDeduct').value],
          ['ê¸°íƒ€ ì†Œë“ê³µì œ', $('otherDeductions').value],
          [],
          ['[ë¡œíŠ¸ ìƒì„¸] #','ì·¨ë“ì¼ì','ì¶œì—°êµ¬ë¶„','ì·¨ë“ë‹¨ê°€','ì‹¤ì œ ë‚©ì…ë‹¨ê°€','ì¸ì¶œì£¼ì‹ìˆ˜','ê³¼ì„¸êµ¬ë¶„']
        ];
        lots.forEach((l,i)=> rows.push([String(i+1), l.acqDate||'', l.kind||'', String(l.acqUnit||0), String(l.paidUnit||0), String(l.shares||0), String(l.taxFlag||'ê³¼ì„¸')]));
        const csv = rows.map(r=>r.join(',')).join('\n');
        const blob = new Blob(["\ufeff"+csv], {type:'text/csv;charset=utf-8;'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='esop_calc_result.csv'; a.click();
      });

      // URL params load
      const qs = new URLSearchParams(location.search);
      for (const id of allFieldIds){ if(qs.has(id)) $(id).value = fmt(toNumber(qs.get(id))); }
      if (qs.has('isSME')) $('isSME').checked = (qs.get('isSME')==='1');
      if (qs.has('wdDate')) $('wdDate').value = qs.get('wdDate');

      if (qs.has('lots')){
        try {
          const arr = JSON.parse(decodeURIComponent(qs.get('lots')));
          if (Array.isArray(arr)){
            clearLots();
            arr.forEach(o=> {
              const kind = (o.kind||'ì§ì›');
              const acqU = Number.isFinite(+o.acqUnit) ? +o.acqUnit : Number.isFinite(+o.unit) ? +o.unit : 0;
              const paidU = (o.paidUnit !== undefined && o.paidUnit !== null && Number.isFinite(+o.paidUnit))
                            ? +o.paidUnit
                            : (kind === 'ì§ì›' ? acqU : 0);
              addLot(o.acqDate||'', acqU, Math.floor(Number.isFinite(+o.shares)?+o.shares:0), kind, paidU, (o.taxFlag||'ê³¼ì„¸'));
            });
          } else addLot();
        } catch(e){ addLot(); }
      } else {
        addLot();
      }
    }

    function init(){ bindMasks(); bindActions(); render(); }
    init();
  
// === Profile Save/Load (input-based) ===
function getAppState(){
  return { v: JSON.parse(JSON.stringify(v)), lots: JSON.parse(JSON.stringify(lots)) };
}
function setAppState(st){
  if(st.v){ v = Object.assign(v, st.v); }
  if(st.lots){ lots = st.lots; }
  render();
}
function readProfileName(){
  return (document.getElementById('profileName').value||'').trim();
}
function saveProfile(){
  const name = readProfileName();
  if(!name){ alert('í”„ë¡œí•„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  localStorage.setItem('ESOP_PROFILE_'+name, JSON.stringify(getAppState()));
  alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
function loadProfile(){
  const name = readProfileName();
  if(!name){ alert('ë¶ˆëŸ¬ì˜¬ í”„ë¡œí•„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  const raw = localStorage.getItem('ESOP_PROFILE_'+name);
  if(!raw){ alert('í•´ë‹¹ ì´ë¦„ì˜ í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
  setAppState(JSON.parse(raw));
}
function deleteProfile(){
  const name = readProfileName();
  if(!name){ alert('ì‚­ì œí•  í”„ë¡œí•„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  if(!localStorage.getItem('ESOP_PROFILE_'+name)){ alert('í•´ë‹¹ ì´ë¦„ì˜ í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
  if(confirm('['+name+'] í”„ë¡œí•„ì„ ì‚­ì œí• ê¹Œìš”?')){
    localStorage.removeItem('ESOP_PROFILE_'+name);
    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
}
document.addEventListener('DOMContentLoaded', ()=>{
  document.getElementById('btnSaveProfile').addEventListener('click', saveProfile);
  document.getElementById('btnLoadProfile').addEventListener('click', loadProfile);
  document.getElementById('btnDeleteProfile').addEventListener('click', deleteProfile);
});
</script>
</body>
</html>
